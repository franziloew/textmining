---
title: "Topic Modeling of News"
author: "Franziska LÃ¶w"
date: "`r format(Sys.Date())`"
output: github_document
---

```{r, include=FALSE}
# load the packages
libs <- c("tidytext","tidyr","readr","lubridate","tm","stm","RColorBrewer",
          "plyr","dplyr","class","knitr","kableExtra","cldr","data.table",
          "htmlTable","ggplot2","gridExtra","jsonlite","stringr","scales","rjson")
lapply(libs, library, character.only = TRUE)
```

# Load and prepare Dataframe

```{r}
rm(list =ls())

df <- read_csv("../data/eventbride/eventbride_nov_03.csv")
```

# Generate new variables 
```{r}
## Extract site
df$site <- str_extract(df$source, "(?<='uri': ')[A-z][^']*")

# Is video
df$video <- ifelse(grepl("video", df$title, ignore.case = TRUE),1,0)

# number of Facebook shares
df$fb_shares <- str_extract(df$shares, "(?<='facebook': )[0-9]*")
df$fb_shares <- ifelse(is.na(df$fb_shares),0, df$fb_shares)
df$fb_shares <- as.integer(df$fb_shares)

# Text Length
names(df) <- gsub("body", "text", names(df))
df$text_length <- sapply(gregexpr("\\S+", df$text), length)
```

```{r}
ggplot(df, aes(site, fill=as.factor(isDuplicate))) +
  geom_bar(alpha=.6) +
  labs(x="", y="", fill="is Duplicate") +
  theme(axis.text.x = element_text(angle = 40, hjust = 1))
```

```{r}
nov <- df
# Save file
save(nov, file="../output/news_cleaned_eventbride_nov.Rda")
```
