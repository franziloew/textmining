---
title: "Topic Modeling of News"
author: "Franziska LÃ¶w"
date: "`r format(Sys.Date())`"
output: github_document
---

```{r, include=FALSE}
# load the packages
libs <- c("tidytext","tidyr","readr","lubridate","tm","stm","RColorBrewer",
          "plyr","dplyr","class","knitr","kableExtra","cldr","data.table",
          "htmlTable","ggplot2","gridExtra","jsonlite","stringr","scales","rjson")
lapply(libs, library, character.only = TRUE)

```

# Load and prepare Dataframe

```{r}
rm(list = ls())

# create a character vector, with each file name represented by an entry
june <- list.files("../data/webhoseio/2017-06", pattern="*.json", full.names=TRUE) 
july <- list.files("../data/webhoseio/2017-07", pattern="*.json", full.names=TRUE) 
aug <- list.files("../data/webhoseio/2017-08", pattern="*.json", full.names=TRUE) 
sep <- list.files("../data/webhoseio/2017-09", pattern="*.json", full.names=TRUE) 


# a list in which each element is one of your original JSON files
myJSON <- lapply(c(june,july,aug,sep), function(x) fromJSON(file=x)) 
```

## Convert List to Dataframe

```{r}
site <- NULL
title <- NULL
text <- NULL
published <- NULL
section <- NULL

fb_shares <- NULL
fb_likes <- NULL
fb_comments <- NULL

#external_links <- NULL

for (i in 1:length(myJSON)){
  site <- append(site, myJSON[[i]]["thread"][[1]]["site"][[1]])
  title <- append(title, myJSON[[i]]["title"][[1]])
  text <- append(text, myJSON[[i]]["text"][[1]])
  published <- append(published, myJSON[[i]]["published"][[1]])
  section <- append(section, myJSON[[i]]["thread"][[1]]["section_title"][[1]])
  
  fb_shares <- append(fb_shares, myJSON[[i]]["thread"][[1]]["social"][[1]]["facebook"][[1]][["shares"]])
  fb_likes <- append(fb_likes, myJSON[[i]]["thread"][[1]]["social"][[1]]["facebook"][[1]][["likes"]])
  fb_comments <- append(fb_likes, myJSON[[i]]["thread"][[1]]["social"][[1]]["facebook"][[1]][["comments"]])
  
}

df <- cbind(site, title, text, published, section, fb_shares, fb_likes, fb_comments)
df <- data.frame(df, stringsAsFactors = FALSE)
```

```{r}
rm(site, title, text, published, fb_shares, fb_likes, section, fb_comments)
```

## Clean Data
```{r}
df %>%
  mutate(fb_shares = as.integer(fb_shares),
         fb_likes = as.integer(fb_likes),
         fb_comments = as.integer(fb_comments)) -> df
```

### Date
```{r, eval=FALSE, include=FALSE}
# .... date
df$date <- substr(df$published, 1,10)
df$date <- as.POSIXct(df$date, format ="%Y-%m-%d")

#df <- subset(df, df$date > "2017-09-01")
```

## Count number of terms in a string
```{r}
df$text_length <- sapply(gregexpr("\\S+", df$text), length)
```

```{r}
# Save file
save(df, file="../output/news_cleaned.Rda")
```
